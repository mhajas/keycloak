<#import "/templates/guide.adoc" as tmpl>
<#import "/templates/kc.adoc" as kc>
<#import "/templates/options.adoc" as opts>
<#import "/templates/links.adoc" as links>

<@tmpl.guide
title="Enabling {project_name} Event Metrics"
summary="Learn how to enable and use {project_name} Event Metrics"
includedOptions="metrics-enabled user-event-metrics-*">

== Enable event metrics

To start collecting metrics, enable the feature `user-event-metrics`, enable metrics, and enable the metrics for user events.

The following shows the required startup parameters:

<@kc.start parameters="--features=user-event-metrics --metrics-enabled=true --user-event-metrics-enabled=true ..."/>

There will be a separate metric for each realm, client and identity provider.
If your installation has a lot of them, you'll see a lot of individual metrics. To reduce the number of individual metrics created by them, you can limit the metrics dimension using the configuration option `user-event-metrics-tags`.

The following limits the tags to the realm tag:

The snippet below is an example of a response:

<@kc.start parameters="... --user-event-metrics-tags=realm ..."/>

// FIXME: Example might be outdated

[source]
----

# TYPE keycloak_simple_events counter
# HELP keycloak_simple_events The total number of Keycloak events
keycloak_simple_events_total{event="update_password",realm="master"} 1.0
keycloak_simple_events_total{event="update_credential",realm="master"} 1.0
# TYPE keycloak_events counter
# HELP keycloak_events The total number of Keycloak events
keycloak_events_total{client_id="security-admin-console",error="",event="code_to_token",idp="",realm="master"} 6.0
keycloak_events_total{client_id="security-admin-console",error="",event="logout",idp="",realm="master"} 2.0
keycloak_events_total{client_id="security-admin-console",error="",event="login",idp="",realm="master"} 6.0
keycloak_events_total{client_id="security-admin-console",error="",event="refresh_token",idp="",realm="master"} 2.0
keycloak_events_total{client_id="",error="client_not_found",event="login_error",idp="",realm="master"} 1.0
...
----


</@tmpl.guide>
